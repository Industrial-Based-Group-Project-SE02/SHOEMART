<UserControl x:Class="ShoeRetailPOS.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:ShoeRetailPOS.ViewModels"
             Background="#121212">

    <!-- ================= DATA CONTEXT ================= -->
    <UserControl.DataContext>
        <vm:DashboardViewModel/>
    </UserControl.DataContext>

    <!-- ================= RESOURCES ================= -->
    <UserControl.Resources>
        <!-- Colors -->
        <Color x:Key="PrimaryRedColor">#E53935</Color>
        <Color x:Key="DarkRedColor">#C62828</Color>

        <SolidColorBrush x:Key="PrimaryRed" Color="{StaticResource PrimaryRedColor}"/>
        <SolidColorBrush x:Key="DarkRed" Color="{StaticResource DarkRedColor}"/>

        <!-- Product Card -->
        <Style x:Key="ProductCardStyle" TargetType="Border">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Margin" Value="8"/>
            <Setter Property="Padding" Value="10"/>
        </Style>

        <!-- Add To Cart -->
        <Style x:Key="AddToCartButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryRed}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>

        <!-- Cart Item -->
        <Style x:Key="CartItemStyle" TargetType="Border">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Margin" Value="0,8"/>
            <Setter Property="Padding" Value="15"/>
        </Style>

        <!-- Cart Quantity Button -->
        <Style x:Key="CartQuantityButton" TargetType="Button">
            <Setter Property="Background" Value="#333333"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Width" Value="28"/>
            <Setter Property="Height" Value="28"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                        CornerRadius="14">
                            <ContentPresenter
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background"
                                Value="{StaticResource PrimaryRed}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Checkout / Proceed Button -->
        <Style x:Key="CheckoutButton" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource PrimaryRed}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="16,14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                        CornerRadius="6">
                            <ContentPresenter
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background"
                                Value="{StaticResource DarkRed}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Hold Button Style -->
        <Style x:Key="HoldButton" TargetType="Button">
            <Setter Property="Background" Value="#333333"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Padding" Value="16,14"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                        CornerRadius="6">
                            <ContentPresenter
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#444444"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Search Box Style -->
        <Style x:Key="SearchBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="#1E1E1E"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderBrush" Value="#333333"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Padding" Value="40,12,12,12"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="CaretBrush" Value="White"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>

            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border
                    Background="{TemplateBinding Background}"
                    BorderBrush="{TemplateBinding BorderBrush}"
                    BorderThickness="{TemplateBinding BorderThickness}"
                    CornerRadius="6">

                            <!-- THIS is where typed text renders -->
                            <ScrollViewer
                                x:Name="PART_ContentHost"
                                Margin="{TemplateBinding Padding}"
                                Foreground="{TemplateBinding Foreground}"
                                FontSize="{TemplateBinding FontSize}"
                                VerticalAlignment="Center"/>
                                </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsFocused" Value="True">
                                <Setter Property="BorderBrush" Value="{StaticResource PrimaryRed}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>


    </UserControl.Resources>

    <!-- ================= LAYOUT ================= -->
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <!-- ================= PRODUCTS SECTION ================= -->
        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 🔍 Search Bar -->
            <Grid Grid.Row="0" Margin="20,20,20,10">
                <TextBox
                    Foreground="White"
                     CaretBrush="White"
                    Height="45"
                    Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                    KeyDown="SearchBox_KeyDown"
                    ToolTip="Search products or scan SKU">

                    <TextBox.Template>
                        <ControlTemplate TargetType="TextBox">
                            <Border
                                Background="#1E1E1E"
                                BorderBrush="#333333"
                                BorderThickness="1"
                                CornerRadius="6">

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="40"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Search Icon (INSIDE TextBox) -->
                                    <TextBlock
                                        Grid.Column="0"
                                        Text="&#xE721;"
                                        FontFamily="Segoe MDL2 Assets"
                                        Foreground="#AAAAAA"
                                        FontSize="16"
                                        VerticalAlignment="Center"
                                        HorizontalAlignment="Center"/>

                                    <!-- Text Host -->
                                    <ScrollViewer
                                        Grid.Column="1"
                                        x:Name="PART_ContentHost"
                                        Margin="0,12,12,12"
                                        Foreground="{TemplateBinding Foreground}"
                                        FontSize="{TemplateBinding FontSize}"/>

                                </Grid>
                            </Border>

                            <ControlTemplate.Triggers>
                                <Trigger Property="IsFocused" Value="True">
                                    <Setter Property="BorderBrush" Value="{StaticResource PrimaryRed}"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </TextBox.Template>
                </TextBox>
            </Grid>

            <!-- 🧾 Products List -->
            <ScrollViewer Grid.Row="1" Padding="20,10,20,20">
                <ItemsControl ItemsSource="{Binding Products}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel/>
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>

                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource ProductCardStyle}"
                            Width="180"
                            Height="260">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="140"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Image -->
                                    <Image Grid.Row="0"
                                   Source="{Binding FirstImage}"
                                   Stretch="UniformToFill"/>

                                    <!-- Details -->
                                    <StackPanel Grid.Row="1" Margin="0,8">
                                        <TextBlock Text="{Binding Name}"
                                           Foreground="White"
                                           FontWeight="Bold"
                                           TextWrapping="Wrap"/>
                                        <TextBlock Text="{Binding MainCategory}"
                                           Foreground="#AAAAAA"
                                           FontSize="12"/>
                                    </StackPanel>

                                    <!-- Price + Add -->
                                    <Grid Grid.Row="2">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBlock Text="{Binding Price, StringFormat=Rs. {0:N2}}"
                                           Foreground="White"
                                           FontWeight="Bold"
                                           VerticalAlignment="Center"/>

                                        <Button Grid.Column="1"
                                        Content="+"
                                        Width="30"
                                        Height="30"
                                        Style="{StaticResource AddToCartButton}"
                                        Command="{Binding DataContext.OpenProductDetailsCommand,
                                                  RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"/>
                                    </Grid>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Grid>



        <!-- ================= CART ================= -->
        <Border Grid.Column="1"
        Background="#1A1A1A"
        Padding="20"
        MinWidth="380">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Cart Header -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,20">
                    <TextBlock Text="&#xE7C4;"
                       FontFamily="Segoe MDL2 Assets"
                       Foreground="{StaticResource PrimaryRed}"
                       FontSize="24"/>
                    <TextBlock Text="Cart"
                       Foreground="White"
                       FontSize="24"
                       FontWeight="Bold"
                       Margin="10,0,0,0"/>
                </StackPanel>

                <!-- Cart Items -->
                <ListBox Grid.Row="1"
                 ItemsSource="{Binding CartItems}"
                 BorderThickness="0"
                 Background="Transparent"
                 HorizontalContentAlignment="Stretch">

                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Style="{StaticResource CartItemStyle}">
                                <Grid Margin="5">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Image -->
                                    <Image Source="{Binding FirstImage}"
                                   Width="70"
                                   Height="70"
                                   Margin="0,0,15,0"/>

                                    <!-- Product Info -->
                                    <StackPanel Grid.Column="1">
                                        <TextBlock Text="{Binding Name}"
                                           Foreground="White"
                                           FontWeight="SemiBold"
                                           FontSize="14"/>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="Size: "
                                               Foreground="#AAAAAA"
                                               FontSize="12"/>
                                            <TextBlock Text="{Binding SelectedSize}"
                                               Foreground="#AAAAAA"
                                               FontSize="12"/>
                                        </StackPanel>

                                        <TextBlock Text="{Binding Price, StringFormat=Rs. {0:N2}}"
                                           Foreground="{StaticResource PrimaryRed}"
                                           FontWeight="Bold"
                                           Margin="0,5,0,0"/>
                                    </StackPanel>

                                    <!-- Quantity + Remove -->
                                    <StackPanel Grid.Column="2"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Center">

                                        <!-- Remove -->
                                        <Button Content="✕"
                                        Foreground="#CCCCCC"
                                        Background="Transparent"
                                        BorderThickness="0"
                                        FontSize="14"
                                        HorizontalAlignment="Right"
                                        Command="{Binding DataContext.RemoveFromCartCommand,
                                                  RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        CommandParameter="{Binding}"/>

                                        <!-- Quantity Controls -->
                                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                            <Button Content="-"
                                            Width="28"
                                            Height="28"
                                            Style="{StaticResource CartQuantityButton}"
                                            Command="{Binding DataContext.DecreaseQuantityCommand,
                                                      RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"/>

                                            <TextBlock Text="{Binding Quantity}"
                                               Foreground="White"
                                               FontWeight="Bold"
                                               Margin="10,0"
                                               VerticalAlignment="Center"/>

                                            <Button Content="+"
                                            Width="28"
                                            Height="28"
                                            Style="{StaticResource CartQuantityButton}"
                                            Command="{Binding DataContext.IncreaseQuantityCommand,
                                                      RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding}"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <!-- Totals -->
                <StackPanel Grid.Row="2" Margin="0,20,0,0">
                    <Grid Margin="0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Subtotal"
                           Foreground="#AAAAAA"/>
                        <TextBlock Text="{Binding Subtotal, StringFormat=Rs. {0:N2}}"
                           Grid.Column="1"
                           Foreground="#AAAAAA"/>
                    </Grid>

                    <Grid Margin="0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="Total"
                           Foreground="White"
                           FontWeight="Bold"
                           FontSize="16"/>
                        <TextBlock Text="{Binding Total, StringFormat=Rs. {0:N2}}"
                           Grid.Column="1"
                           Foreground="{StaticResource PrimaryRed}"
                           FontWeight="Bold"
                           FontSize="16"/>
                    </Grid>
                </StackPanel>

                <!-- Proceed Button -->
                <Button Grid.Row="3"
                Content="Proceed to Payment"
                Style="{StaticResource CheckoutButton}"
                Margin="0,20,0,0"
                Height="50"
                Command="{Binding ProceedToPaymentCommand}"/>

                <!-- Hold Button -->
                <Button Grid.Row="4"
                Content="Hold"
                Style="{StaticResource HoldButton}"
                Margin="0,10,0,0"
                Height="50"/>
            </Grid>
        </Border>


    </Grid>
</UserControl>